# ============================================================================
# NEWS SUMMARIZER API - ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!
# ============================================================================

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
APP_NAME=News Summarizer API
APP_VERSION=1.0.0
ENVIRONMENT=production
# Options: development, staging, production
DEBUG=False

# Server Configuration
HOST=0.0.0.0
PORT=8000
API_V1_PREFIX=/api/v1
FRONTEND_URL=http://localhost:8501

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# Runtime database config used by config.py
DB_USER=postgres
DB_PASSWORD=password
DB_HOST=localhost
DB_PORT=5432
DB_NAME=ai_news
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=5
DB_POOL_TIMEOUT=15
DB_POOL_RECYCLE=900


# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
# Redis Connection String (for caching and rate limiting)
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=50
REDIS_CACHE_TTL=900
REDIS_KEY_PREFIX=news_app
REDIS_PASSWORD=password
# Celery defaults to REDIS_URL when these are not set explicitly
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0
CELERY_HEARTBEAT_INTERVAL_SECONDS=60
CELERY_HEARTBEAT_TTL_SECONDS=180
CELERY_HEARTBEAT_LOG_INTERVAL_SECONDS=60
# Cache TTL in seconds (default: 15 minutes)

# ============================================================================
# SECURITY & AUTHENTICATION
# ============================================================================
# Secret Key (MUST be at least 32 characters, generate with: python -c "import secrets; print(secrets.token_urlsafe(32))")
SECRET_KEY=your-super-secret-key-change-this-in-production-min-32-chars

# JWT Configuration (RS256 Algorithm with Public/Private Keys)
JWT_ALGORITHM=RS256
JWT_PRIVATE_KEY_PATH=./keys/private_key.pem
JWT_PUBLIC_KEY_PATH=./keys/public_key.pem
# Optional: Provide keys directly as environment variables (overrides file paths)
# JWT_PRIVATE_KEY=
# JWT_PUBLIC_KEY=

# Token Expiration
ACCESS_TOKEN_EXPIRE_HOURS=1
REFRESH_TOKEN_EXPIRE_DAYS=7

# Bcrypt/Argon2 Configuration
BCRYPT_ROUNDS=12
ARGON2_TIME_COST=2
ARGON2_MEMORY_COST=65536
# 64 MB
ARGON2_PARALLELISM=4
ARGON2_HASH_LENGTH=32
ARGON2_SALT_LENGTH=16

# ============================================================================
# PASSWORD POLICY
# ============================================================================
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=True
PASSWORD_REQUIRE_LOWERCASE=True
PASSWORD_REQUIRE_DIGIT=True
PASSWORD_REQUIRE_SPECIAL=True

# ============================================================================
# ACCOUNT SECURITY
# ============================================================================
MAX_LOGIN_ATTEMPTS=5
ACCOUNT_LOCKOUT_DURATION_MINUTES=30
FAILED_LOGIN_RESET_HOURS=24

# Email Verification
EMAIL_VERIFICATION_REQUIRED=False
EMAIL_VERIFICATION_TOKEN_EXPIRE_HOURS=24
PASSWORD_RESET_TOKEN_EXPIRE_HOURS=1

# Session Management
MAX_ACTIVE_SESSIONS=5
SESSION_CLEANUP_INTERVAL_HOURS=1

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
# Comma-separated list of allowed origins
CORS_ENABLED=true
CORS_ORIGINS=["http://localhost:3000", "http://localhost:8080", "http://localhost:8501", "http://localhost:8000", "http://127.0.0.1:8501"]
CORS_ALLOW_CREDENTIALS=True
CORS_ALLOW_METHODS=["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
CORS_ALLOW_HEADERS=["Authorization","Content-Type","X-API-Key","X-Integration-Key"]
CORS_MAX_AGE=600

# ============================================================================
# SECURITY HEADERS
# ============================================================================
ENABLE_HSTS=True
HSTS_MAX_AGE=31536000
# 1 year in seconds
ENABLE_CSP=True
CSP_POLICY=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;

# Cookie Settings
COOKIE_SECURE=True
# Set to False in development with HTTP
COOKIE_HTTPONLY=True
COOKIE_SAMESITE=lax

# API Security
API_KEY_HEADER=X-API-Key
INTEGRATION_KEY_HEADER=X-Integration-Key

# ============================================================================
# INTEGRATION API + WEBHOOK DELIVERY
# ============================================================================
# Feature toggles
ENABLE_INTEGRATION_API=False
ENABLE_INTEGRATION_DELIVERY=False

# Required in production when ENABLE_INTEGRATION_API=True
# Generate Fernet key:
# python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
INTEGRATION_ENCRYPTION_KEY_CURRENT=
INTEGRATION_ENCRYPTION_KEY_PREVIOUS=

# Integration runtime controls
INTEGRATION_DEFAULT_RATE_LIMIT_PER_HOUR=1000
INTEGRATION_FEED_CACHE_TTL=900
INTEGRATION_WEBHOOK_TIMEOUT_SECONDS=5
INTEGRATION_WEBHOOK_MAX_FAILURES=5
INTEGRATION_DELIVERY_RETENTION_DAYS=30

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=True
RATE_LIMIT_PER_MINUTE=100
RATE_LIMIT_BURST=20
RATE_LIMIT_BACKOFF_BASE=2.0
RATE_LIMIT_MAX_VIOLATIONS=5
RATE_LIMIT_BAN_DURATION_MINUTES=60

# Auth-specific rate limits
AUTH_RATE_LIMIT_PER_MINUTE=10
AUTH_RATE_LIMIT_PER_HOUR=100

# ============================================================================
# REQUEST VALIDATION
# ============================================================================
MAX_REQUEST_SIZE_MB=1
ALLOWED_CONTENT_TYPES=["application/json", "multipart/form-data", "application/x-www-form-urlencoded"]

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================
# Provider: smtp | graph (app-only) | graph_msa (delegated personal mailbox)
EMAIL_DELIVERY_PROVIDER=smtp
EMAIL_REQUEST_TIMEOUT_SECONDS=15
EMAIL_MAX_RETRIES=2

# Microsoft Graph OAuth2 - App-only (organization mailbox)
GRAPH_TENANT_ID=your-tenant-id
GRAPH_CLIENT_ID=your-app-client-id
GRAPH_CLIENT_SECRET=your-app-client-secret
GRAPH_SENDER_USER=sender@your-org-domain.com
GRAPH_SCOPE=https://graph.microsoft.com/.default
GRAPH_API_BASE_URL=https://graph.microsoft.com/v1.0
GRAPH_AUTH_BASE_URL=https://login.microsoftonline.com
GRAPH_SAVE_TO_SENT_ITEMS=true

# Microsoft Graph OAuth2 - Delegated (personal Outlook mailbox via MSAL)
GRAPH_MSA_CLIENT_ID=your-public-client-id
GRAPH_MSA_AUTHORITY=https://login.microsoftonline.com/consumers
GRAPH_MSA_SCOPES=https://graph.microsoft.com/Mail.Send
GRAPH_MSA_TOKEN_CACHE_FILE=secrets/graph_msa_token_cache.json
GRAPH_MSA_AUTO_DEVICE_FLOW=false

# SMTP (optional fallback or non-Microsoft providers)
SMTP_HOST=smtp-mail.outlook.com
SMTP_PORT=587
SMTP_USER=your-email@outlook.com
SMTP_PASSWORD=your-smtp-password
SMTP_FROM_EMAIL=your-email@outlook.com
SMTP_FROM_NAME=News Central
# Destination mailbox for "Let's connect" contact form submissions
DEVELOPER_CONTACT_EMAIL=your-email@outlook.com

# ============================================================================
# NEWS AGGREGATION SERVICES
# ============================================================================
# NewsAPI Configuration (https://newsapi.org/)
NEWSAPI_KEY=your-newsapi-key-here
NEWSAPI_BASE_URL=https://newsapi.org/v2
NEWSAPI_TIMEOUT=5
NEWSAPI_MAX_RETRIES=3

# GDELT Configuration (no API key required)
GDELT_BASE_URL=https://api.gdeltproject.org/api/v2/doc/doc
GDELT_TIMEOUT=5

# News Aggregation Settings
NEWS_CACHE_TTL=900
# 15 minutes in seconds
NEWS_DEDUPLICATION_THRESHOLD=0.8
# 80% similarity threshold
NEWS_CIRCUIT_BREAKER_THRESHOLD=5
NEWS_CIRCUIT_BREAKER_TIMEOUT=60
NEWS_MAX_ARTICLES_PER_SOURCE=50
ENABLE_NEWS_SCHEDULER=True
NEWS_FETCH_INTERVAL_HOURS=2
NEWS_SOURCES=newsapi,gdelt,rss
NEWS_FETCH_QUERIES=technology,artificial intelligence,business,science,health,world news,politics,entertainment,sports
ENABLE_RSS_FEEDS=True
RSS_FEED_URLS=https://rss.nytimes.com/services/xml/rss/nyt/Technology.xml,https://feeds.bbci.co.uk/news/technology/rss.xml,https://www.wired.com/feed/rss,https://techcrunch.com/feed/,https://www.theverge.com/rss/index.xml
# JSON object mapping topic -> RSS feed URLs
RSS_TOPIC_FEED_URLS={"technology":["https://rss.nytimes.com/services/xml/rss/nyt/Technology.xml"],"science":["https://rss.nytimes.com/services/xml/rss/nyt/Science.xml"],"business":["https://rss.nytimes.com/services/xml/rss/nyt/Business.xml"],"politics":["https://rss.nytimes.com/services/xml/rss/nyt/Politics.xml"],"health":["https://rss.nytimes.com/services/xml/rss/nyt/Health.xml"],"sports":["https://rss.nytimes.com/services/xml/rss/nyt/Sports.xml"],"entertainment":["https://rss.nytimes.com/services/xml/rss/nyt/Arts.xml"],"world":["https://rss.nytimes.com/services/xml/rss/nyt/World.xml"]}

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=INFO
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FILE=logs/app.log
LOG_MAX_SIZE_MB=10
LOG_BACKUP_COUNT=5
LOG_REQUESTS=True
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================
UPLOAD_DIR=uploads
MAX_UPLOAD_SIZE_MB=10
ALLOWED_EXTENSIONS=[".jpg", ".jpeg", ".png", ".gif", ".pdf", ".txt", ".csv"]

# ============================================================================
# PRODUCTION DEPLOYMENT NOTES
# ============================================================================
# 1. Generate a strong SECRET_KEY:
#    python -c "import secrets; print(secrets.token_urlsafe(32))"
#
# 2. Generate RSA key pair for JWT:
#    python generate_keys.py
#
# 3. Set ENVIRONMENT=production
#
# 4. Set DEBUG=False
#
# 5. Set COOKIE_SECURE=True (requires HTTPS)
#
# 6. Use strong database credentials (not default passwords)
#
# 7. Configure proper CORS_ORIGINS for your frontend
#
# 8. Set up SMTP with actual email service credentials
#
# 9. Get actual API keys:
#    - NewsAPI: https://newsapi.org/
#
# 10. Never commit .env to version control!
#     Add .env to .gitignore
# ============================================================================

